-- Shape pm
select * from (

Select codigo,tipo,clase,cat,nombre,municipio,corriente,departamento,altitud,cod_dep,cod_muni,longitud,latitud,estado,geom,
max(enero) max_enero,max(febrero) max_febrero,max(marzo) max_marzo,max(abril) max_abril,max(mayo) max_mayo,max(junio) max_junio,max(julio) max_julio,max(agosto) max_agosto,max(septiembre) max_septiembre,max(octubre) max_octubre,max(noviembre) max_noviembre,max(diciembre) max_diciembre,
GREATEST(max(enero),max(febrero),max(marzo),max(abril),max(mayo),max(junio),max(julio),max(agosto),max(septiembre),max(octubre),max(noviembre),max(diciembre)) max_anual,
min(enero) min_enero,min(febrero) min_febrero,min(marzo) min_marzo,min(abril) min_abril,min(mayo) min_mayo,min(junio) min_junio,min(julio) min_julio,min(agosto) min_agosto,min(septiembre) min_septiembre,min(octubre) min_octubre,min(noviembre) min_noviembre,min(diciembre) min_diciembre,
LEAST(min(enero),min(febrero),min(marzo),min(abril),min(mayo),min(junio),min(julio),min(agosto),min(septiembre),min(octubre),min(noviembre),min(diciembre)) min_anual,
avg(enero) evt_enero,avg(febrero) evt_febrero,avg(marzo) evt_marzo,avg(abril) evt_abril,avg(mayo) evt_mayo,avg(junio) evt_junio,avg(julio) evt_julio,avg(agosto) evt_agosto,avg(septiembre) evt_septiembre,avg(octubre) evt_octubre,avg(noviembre) evt_noviembre,avg(diciembre) evt_diciembre,
case when avg(enero) IS NULL then 0 else avg(enero) end +
case when avg(febrero) IS NULL then 0 else avg(febrero) end +
case when avg(marzo) IS NULL then 0 else avg(marzo) end +
case when avg(abril) IS NULL then 0 else avg(abril)  end +
case when avg(mayo)  IS NULL then 0 else avg(mayo) end +
case when avg(junio) IS NULL then 0 else avg(junio) end +
case when avg(julio) IS NULL then 0 else avg(julio) end +
case when avg(agosto) IS NULL then 0 else avg(agosto) end  +
case when avg(septiembre) IS NULL then 0 else avg(septiembre) end +
case when avg(octubre) IS NULL then 0 else avg(octubre) end +
case when avg(noviembre) IS NULL then 0 else avg(noviembre) end +
case when avg(diciembre) IS NULL then 0 else avg(diciembre) end as anual
from tmp_query_prom
group by codigo,tipo,clase,cat,nombre,municipio,corriente,departamento,altitud,cod_dep,cod_muni,longitud,latitud,estado,geom) as tmp
where anual > 0
